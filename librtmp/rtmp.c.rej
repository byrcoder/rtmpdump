***************
*** 863,868 ****
  RTMP_TLS_Accept(RTMP *r, void *ctx)
  {
  #if defined(CRYPTO) && !defined(NO_SSL)
    TLS_server(ctx, r->m_sb.sb_ssl);
    TLS_setfd(r->m_sb.sb_ssl, r->m_sb.sb_socket);
    if (TLS_accept(r->m_sb.sb_ssl) < 0)
--- 880,889 ----
  RTMP_TLS_Accept(RTMP *r, void *ctx)
  {
  #if defined(CRYPTO) && !defined(NO_SSL)
+   if (r->hook) {
+       return r->hook->RTMP_TLS_Accept(r, ctx);
+   }
+ 
    TLS_server(ctx, r->m_sb.sb_ssl);
    TLS_setfd(r->m_sb.sb_ssl, r->m_sb.sb_socket);
    if (TLS_accept(r->m_sb.sb_ssl) < 0)
***************
*** 3560,3575 ****
    while (1)
      {
        nBytes = sizeof(sb->sb_buf) - 1 - sb->sb_size - (sb->sb_start - sb->sb_buf);
  #if defined(CRYPTO) && !defined(NO_SSL)
-       if (sb->sb_ssl)
- 	{
- 	  nBytes = TLS_read(sb->sb_ssl, sb->sb_start + sb->sb_size, nBytes);
- 	}
-       else
  #endif
- 	{
- 	  nBytes = recv(sb->sb_socket, sb->sb_start + sb->sb_size, nBytes, 0);
- 	}
        if (nBytes != -1)
  	{
  	  sb->sb_size += nBytes;
--- 3586,3605 ----
    while (1)
      {
        nBytes = sizeof(sb->sb_buf) - 1 - sb->sb_size - (sb->sb_start - sb->sb_buf);
+       if (r->hook)
+       {
+         nBytes = r->hook->RTMPSockBuf_Fill(sb, sb->sb_start + sb->sb_size, nBytes);
+       }
+       else {
  #if defined(CRYPTO) && !defined(NO_SSL)
+         if (sb->sb_ssl) {
+           nBytes = TLS_read(sb->sb_ssl, sb->sb_start + sb->sb_size, nBytes);
+         } else
  #endif
+         {
+           nBytes = recv(sb->sb_socket, sb->sb_start + sb->sb_size, nBytes, 0);
+         }
+       }
        if (nBytes != -1)
  	{
  	  sb->sb_size += nBytes;
